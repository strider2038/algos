# Алгоритмы для поиска и фильтрации деревьев

## Суть задачи

Необходимо отфильтровать часть дерева (организовать саджест) по наличию вхождения подстрок в любые дочерние
узлы дерева.

## План исследования

* [x] простая реализация поиском подстрок
* [x] реализация на основе битовых слайсов
* [x] оптимизация по памяти на основе битовых карт
* [x] расчет памяти
* [x] сравнительные таблицы
* [ ] варианты оптимизаций
    * [x] использовать sparse bit array
    * [ ] сортировка индексов (выбор диапазона при поиске вместо перебора листьев)
    * [ ] оптимизация trie для строк (оверхед преобразования в слайс байт)
    * [ ] оптимизация битовой маски (алгоритм выбора оптимальных индексов)
* [ ] протестировать на большом наборе данных
* [ ] реализация живого примера

## Сравнение

Версии алгоритмов

* `simple_search` - реализация на основе рекурсивного перебора дерева и поиска подстрок
* `bitset_search` - реализация на основе битовых индексов в слайсе
* `bitmap_search` - реализация на основе битовых индексов в карте (хеш-таблице)
* `sparsebits_search` - реализация на основе разреженных битовых индексов

Разница в логике работы алгоритмов. Для простого варианта поиск происходит по
нахождению подстроки в любой части названия. Для префиксного поиска поиск
осуществляется по левому вхождению (выбор всех возможных ключевых слов по префиксу).

Варианты тестов

* top node, one word - фильтр по слову из корневого узла (рекурсия не запускается)
* deep node, one word - фильтр по слову из листа дерева (глубокое погружение в рекурсию)
* deep node, many words - фильтр по большому количеству слов из листа (много сравнение строк)
* single char - фильтр по единственной букве
* prefix - фильтр по префиксу

| test                  |          simple |       bitset |       bitmap |  sparse bits |
|-----------------------|----------------:|-------------:|-------------:|-------------:|
| memory                |          363 Kb |     1 159 Kb |       765 Kb |       809 Kb |
| top node, one word    | 5 237 723 ns/op |  6 938 ns/op |  6 787 ns/op |  6 836 ns/op |
| deep node, one word   | 2 626 655 ns/op |  6 786 ns/op |  6 727 ns/op |  6 797 ns/op |
| deep node, many words | 5 379 650 ns/op | 51 234 ns/op | 53 447 ns/op | 51 950 ns/op |
| single char           |    35 097 ns/op |  9 677 ns/op | 17 213 ns/op | 12 545 ns/op |
| prefix                | 2 001 686 ns/op |  7 201 ns/op |  8 966 ns/op |  7 860 ns/op |
